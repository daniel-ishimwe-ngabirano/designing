<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Simple Add to Cart Demo</title>
  <style>
    :root{--accent:#2563eb;--muted:#666;font-family:system-ui,-apple-system,Segoe UI,Roboto,'Helvetica Neue',Arial}
    body{font-family:var(--font);margin:0;padding:24px;background:#f7f8fb;color:#111}
    .container{max-width:1000px;margin:0 auto;display:grid;grid-template-columns:1fr 360px;gap:24px}
    .products{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:16px}
    .card{background:#fff;padding:12px;border-radius:10px;box-shadow:0 6px 18px rgba(15,23,42,0.06);display:flex;flex-direction:column;gap:8px}
    .thumb{height:140px;border-radius:8px;object-fit:cover;background:#eee}
    .title{font-weight:600;font-size:15px}
    .price{font-weight:700;color:var(--accent)}
    button{background:var(--accent);color:white;border:0;padding:8px 12px;border-radius:8px;cursor:pointer}
    button:disabled{opacity:.6;cursor:not-allowed}
    .cart{background:#fff;padding:12px;border-radius:10px;box-shadow:0 6px 18px rgba(15,23,42,0.06)}
    .cart h2{margin:0 0 8px 0}
    .cart-list{display:flex;flex-direction:column;gap:10px;max-height:420px;overflow:auto;padding-right:6px}
    .cart-item{display:grid;grid-template-columns:48px 1fr auto;gap:10px;align-items:center}
    .ci-thumb{width:48px;height:48px;border-radius:6px;object-fit:cover;background:#ddd}
    .ci-title{font-size:14px}
    .qty{display:flex;align-items:center;gap:6px}
    .qty button{padding:4px 8px;border-radius:6px;background:#eee;color:#111;border:0;cursor:pointer}
    .remove{background:transparent;color:#c0392b;border:0;cursor:pointer;font-size:14px}
    .totals{margin-top:12px;border-top:1px dashed #eee;padding-top:12px;display:flex;justify-content:space-between;align-items:center}
    .small{font-size:13px;color:var(--muted)}
    .empty{padding:24px;text-align:center;color:var(--muted)}
    @media (max-width:880px){.container{grid-template-columns:1fr}}
  </style>
</head>
<body>
  <div class="container">
    <main>
      <h1>Store — Add to Cart Example</h1>
      <p class="small">Click **Add to cart** to add items. Cart persists in localStorage.</p>

      <section class="products" id="products"></section>
    </main>

    <aside class="cart" aria-labelledby="cart-heading">
      <h2 id="cart-heading">Cart</h2>
      <div id="cart-list" class="cart-list" aria-live="polite"></div>

      <div id="cart-empty" class="empty" hidden>Your cart is empty.</div>

      <div class="totals" id="cart-totals" hidden>
        <div>
          <div class="small">Items</div>
          <div id="cart-count">0</div>
        </div>
        <div style="text-align:right">
          <div class="small">Total</div>
          <div id="cart-total">$0.00</div>
        </div>
      </div>

      <div style="margin-top:12px;display:flex;gap:8px">
        <button id="checkout" disabled>Checkout</button>
        <button id="clear-cart" type="button">Clear</button>
      </div>
    </aside>
  </div>

  <script>
    // SAMPLE PRODUCTS - in a real app you'd fetch from server
    const PRODUCTS = [
      { id: 'p1', title: 'Classic White Shirt', price: 24.99, img: 'https://picsum.photos/id/29/400/300' },
      { id: 'p2', title: 'Blue Denim Jeans', price: 39.5, img: 'https://picsum.photos/id/30/400/300' },
      { id: 'p3', title: 'Running Sneakers', price: 59.99, img: 'https://picsum.photos/id/31/400/300' },
      { id: 'p4', title: 'Black Hoodie', price: 45.0, img: 'https://picsum.photos/id/32/400/300' }
    ];

    // Keys & state
    const STORAGE_KEY = 'simple_cart_v1';
    let cart = {}; // { productId: {id, title, price, qty, img} }

    // Helpers
    const $ = sel => document.querySelector(sel);
    const $$ = sel => document.querySelectorAll(sel);
    const format = n => '$' + n.toFixed(2);

    // Load saved cart from localStorage
    function loadCart() {
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        cart = raw ? JSON.parse(raw) : {};
      } catch (e) {
        cart = {};
      }
    }

    function saveCart() {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(cart));
    }

    // Render product grid
    function renderProducts() {
      const wrap = $('#products');
      wrap.innerHTML = '';
      for (const p of PRODUCTS) {
        const card = document.createElement('article');
        card.className = 'card';
        card.innerHTML = `
          <img class="thumb" src="${p.img}" alt="${escapeHtml(p.title)}">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <div>
              <div class="title">${escapeHtml(p.title)}</div>
              <div class="price">${format(p.price)}</div>
            </div>
            <div>
              <button data-action="add" data-id="${p.id}">Add to cart</button>
            </div>
          </div>
        `;
        wrap.appendChild(card);
      }
    }

    // Render cart UI
    function renderCart() {
      const list = $('#cart-list');
      const totals = $('#cart-totals');
      const emptyMsg = $('#cart-empty');
      list.innerHTML = '';

      const items = Object.values(cart);
      if (items.length === 0) {
        emptyMsg.hidden = false;
        totals.hidden = true;
        $('#checkout').disabled = true;
        $('#cart-count').textContent = '0';
        $('#cart-total').textContent = format(0);
        return;
      }

      emptyMsg.hidden = true;
      totals.hidden = false;
      $('#checkout').disabled = false;

      let total = 0, count = 0;
      for (const it of items) {
        total += it.price * it.qty;
        count += it.qty;

        const row = document.createElement('div');
        row.className = 'cart-item';
        row.innerHTML = `
          <img class="ci-thumb" src="${it.img}" alt="${escapeHtml(it.title)}">
          <div>
            <div class="ci-title">${escapeHtml(it.title)}</div>
            <div class="small">${format(it.price)} each</div>
          </div>
          <div style="text-align:right">
            <div class="qty" data-id="${it.id}">
              <button data-action="dec" aria-label="Decrease quantity">−</button>
              <span class="small" style="min-width:28px;display:inline-block;text-align:center">${it.qty}</span>
              <button data-action="inc" aria-label="Increase quantity">+</button>
            </div>
            <div style="margin-top:6px">
              <button class="remove" data-action="remove" data-id="${it.id}">Remove</button>
            </div>
          </div>
        `;
        list.appendChild(row);
      }

      $('#cart-count').textContent = String(count);
      $('#cart-total').textContent = format(total);
      saveCart();
    }

    // Add product to cart
    function addToCart(productId) {
      const p = PRODUCTS.find(x => x.id === productId);
      if (!p) return;
      if (!cart[p.id]) {
        cart[p.id] = { id: p.id, title: p.title, price: p.price, qty: 1, img: p.img };
      } else {
        cart[p.id].qty += 1;
      }
      renderCart();
    }

    // Change quantity
    function changeQty(productId, delta) {
      const it = cart[productId];
      if (!it) return;
      it.qty += delta;
      if (it.qty <= 0) delete cart[productId];
      renderCart();
    }

    // Remove item
    function removeItem(productId) {
      delete cart[productId];
      renderCart();
    }

    // Clear cart completely
    function clearCart() {
      cart = {};
      saveCart();
      renderCart();
    }

    // Simple escape to prevent accidental HTML injection in this demo
    function escapeHtml(s = '') {
      return s.replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c]));
    }

    // Event listeners (event delegation)
    document.addEventListener('click', (e) => {
      const btn = e.target.closest('button');
      if (!btn) return;

      // Product add buttons
      if (btn.dataset.action === 'add' && btn.dataset.id) {
        addToCart(btn.dataset.id);
        // tiny UI feedback
        btn.textContent = 'Added';
        btn.disabled = true;
        setTimeout(() => { btn.textContent = 'Add to cart'; btn.disabled = false; }, 700);
        return;
      }

      // Cart controls
      const action = btn.dataset.action;
      if (action === 'remove' && btn.dataset.id) {
        removeItem(btn.dataset.id);
        return;
      }

      if (btn.id === 'clear-cart') {
        if (confirm('Clear cart?')) clearCart();
        return;
      }

      if (btn.id === 'checkout') {
        // In a real app you'd send cart to server here
        alert('Proceeding to checkout — demo only.\nCart contents logged to console.');
        console.log('Checkout cart:', cart);
        return;
      }
    });

    // Quantity (+ / −) are inside a .qty container; handle clicks via delegation
    document.addEventListener('click', (e) => {
      const qBtn = e.target.closest('[data-action="inc"], [data-action="dec"]');
      if (!qBtn) return;
      const parent = qBtn.closest('.qty');
      if (!parent) return;
      const id = parent.dataset.id;
      if (!id) return;
      if (qBtn.dataset.action === 'inc') changeQty(id, +1);
      if (qBtn.dataset.action === 'dec') changeQty(id, -1);
    });

    // Initialization
    loadCart();
    renderProducts();
    renderCart();

    // Expose for console debugging (optional)
    window.__demo_cart = { get: () => cart, add: addToCart, clear: clearCart };
  </script>
</body>
</html>
